<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma de Gest칚o de Recados</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding-top: 50px;
        }
        .card {
            margin-top: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        }
        .btn {
            border-radius: 5px;
        }
        .message {
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .emoji-btn {
            margin: 5px;
            cursor: pointer;
        }
        .modal-content {
            width: 90%;
        }
    </style>
</head>
<body>

<div class="container">
    <!-- Tela de Login -->
    <div id="loginScreen" class="card p-4">
        <h2 class="text-center">Login</h2>
        <div id="loginFeedback" class="text-center text-danger d-none"></div>
        <form id="loginForm">
            <div class="mb-3">
                <input type="text" id="loginID" class="form-control" placeholder="ID" required>
            </div>
            <div class="mb-3">
                <input type="password" id="loginPassword" class="form-control" placeholder="Senha" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Entrar</button>
        </form>
    </div>

    <!-- Painel Administrativo -->
    <div id="adminPanel" class="card p-4 d-none">
        <h2 class="text-center">Painel Administrativo</h2>
        <button id="logoutAdmin" class="btn btn-danger w-100">Sair</button>
        <div id="adminActions">
            <h4>Gerenciamento de Recados</h4>
            <button id="addMessage" class="btn btn-success w-100">Enviar Recado</button>
            <div id="adminMessageList"></div>

            <h4 class="mt-4">Gerenciamento de Usu치rios</h4>
            <button id="viewLoggedUsers" class="btn btn-info w-100">Visualizar Usu치rios Logados</button>
            <div id="loggedUsersList"></div>

            <h4 class="mt-4">Criar Novo Usu치rio</h4>
            <form id="createUserForm">
                <input type="text" id="newUserID" class="form-control mb-2" placeholder="ID do Novo Usu치rio" required>
                <input type="password" id="newUserPassword" class="form-control mb-2" placeholder="Senha" required>
                <button type="submit" class="btn btn-primary w-100">Criar Usu치rio</button>
            </form>
        </div>
        <div id="modalMessageForm" class="d-none">
            <textarea id="newMessageText" class="form-control" rows="3" placeholder="Escreva o recado"></textarea>
            <button id="submitNewMessage" class="btn btn-primary w-100 mt-2">Enviar</button>
        </div>
    </div>

    <!-- Painel de Usu치rio Comum -->
    <div id="userPanel" class="card p-4 d-none">
        <h2 class="text-center">Bem-vindo!</h2>
        <div id="userMessages">
            <h4>Recados</h4>
            <!-- Lista de recados -->
        </div>
        <button id="logoutUser" class="btn btn-danger w-100 mt-4">Sair</button>
    </div>

    <!-- Modal para visualiza칞칚o de recados -->
    <div class="modal fade" id="messagesModal" tabindex="-1" aria-labelledby="messagesModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="messagesModalLabel">Recados Enviados</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modalMessagesList">
                    <!-- Recados listados aqui -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Carrega os usu치rios e mensagens do localStorage
    let users = JSON.parse(localStorage.getItem('users')) || [];
    let messages = JSON.parse(localStorage.getItem('messages')) || [];
    const defaultAdmin = { id: 'admin', password: 'admin123', isAdmin: true };

    // Se o admin n칚o existir, cria o administrador no localStorage
    if (!users.some(user => user.id === defaultAdmin.id)) {
        users.push(defaultAdmin);
        localStorage.setItem('users', JSON.stringify(users));
    }

    // Login do usu치rio
    document.getElementById('loginForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const id = document.getElementById('loginID').value;
        const password = document.getElementById('loginPassword').value;
        const user = users.find(u => u.id === id && u.password === password);

        if (user) {
            localStorage.setItem('loggedInUser', JSON.stringify(user));
            if (user.isAdmin) {
                document.getElementById('loginScreen').classList.add('d-none');
                document.getElementById('adminPanel').classList.remove('d-none');
                loadAdminMessages();
            } else {
                document.getElementById('loginScreen').classList.add('d-none');
                document.getElementById('userPanel').classList.remove('d-none');
                loadUserMessages();
            }
        } else {
            document.getElementById('loginFeedback').textContent = 'ID ou senha incorretos!';
            document.getElementById('loginFeedback').classList.remove('d-none');
        }
    });

    // Logout do usu치rio comum
    document.getElementById('logoutUser').addEventListener('click', function () {
        localStorage.removeItem('loggedInUser');
        document.getElementById('userPanel').classList.add('d-none');
        document.getElementById('loginScreen').classList.remove('d-none');
    });

    // Logout do administrador
    document.getElementById('logoutAdmin').addEventListener('click', function () {
        localStorage.removeItem('loggedInUser');
        document.getElementById('adminPanel').classList.add('d-none');
        document.getElementById('loginScreen').classList.remove('d-none');
    });

    // Fun칞칚o para carregar mensagens no painel de usu치rio comum
    function loadUserMessages() {
        const userMessages = document.getElementById('userMessages');
        userMessages.innerHTML = '';
        messages.forEach(msg => {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.innerHTML = `${msg.sender}: ${msg.text} <button class="emoji-btn">游녨</button>`;
            userMessages.appendChild(messageDiv);
        });
    }

    // Fun칞칚o para carregar recados no painel administrativo
    function loadAdminMessages() {
        const adminMessageList = document.getElementById('adminMessageList');
        adminMessageList.innerHTML = '';
        messages.forEach(msg => {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.innerHTML = `${msg.sender}: ${msg.text} <button class="emoji-btn">游녨</button> <button class="btn btn-danger btn-sm deleteMsg">Excluir</button> <button class="btn btn-warning btn-sm editMsg">Editar</button>`;
            adminMessageList.appendChild(messageDiv);
        });

        document.querySelectorAll('.deleteMsg').forEach(btn => {
            btn.addEventListener('click', function () {
                const msgText = btn.parentElement.textContent.split(':')[0];
                messages = messages.filter(msg => msg.sender !== msgText);
                localStorage.setItem('messages', JSON.stringify(messages));
                loadAdminMessages();
            });
        });

        document.querySelectorAll('.editMsg').forEach(btn => {
            btn.addEventListener('click', function () {
                const msgText = btn.parentElement.textContent.split(':')[0];
                const messageToEdit = messages.find(msg => msg.sender === msgText);
                document.getElementById('newMessageText').value = messageToEdit.text;
                document.getElementById('modalMessageForm').classList.remove('d-none');
                document.getElementById('submitNewMessage').addEventListener('click', function () {
                    messageToEdit.text = document.getElementById('newMessageText').value;
                    localStorage.setItem('messages', JSON.stringify(messages));
                    loadAdminMessages();
                    document.getElementById('modalMessageForm').classList.add('d-none');
                });
            });
        });
    }

    // Fun칞칚o para adicionar um novo recado
    document.getElementById('addMessage').addEventListener('click', function () {
        document.getElementById('modalMessageForm').classList.remove('d-none');
        document.getElementById('submitNewMessage').addEventListener('click', function () {
            const messageText = document.getElementById('newMessageText').value;
            if (messageText) {
                const newMessage = { sender: 'Admin', text: messageText };
                messages.push(newMessage);
                localStorage.setItem('messages', JSON.stringify(messages));
                loadAdminMessages();
                document.getElementById('newMessageText').value = '';
                document.getElementById('modalMessageForm').classList.add('d-none');
            }
        });
    });

    // Visualizar usu치rios logados
    document.getElementById('viewLoggedUsers').addEventListener('click', function () {
        const loggedUsersList = document.getElementById('loggedUsersList');
        loggedUsersList.innerHTML = '';
        users.forEach(user => {
            const userDiv = document.createElement('div');
            userDiv.classList.add('message');
            userDiv.innerHTML = `${user.id} - ${user.isAdmin ? 'Administrador' : 'Usu치rio'}`;
            loggedUsersList.appendChild(userDiv);
        });
    });

    // Criar um novo usu치rio
    document.getElementById('createUserForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const newUserID = document.getElementById('newUserID').value;
        const newUserPassword = document.getElementById('newUserPassword').value;

        // Verifica se o usu치rio j치 existe
        if (users.some(user => user.id === newUserID)) {
            alert('Usu치rio j치 existe!');
        } else {
            const newUser = { id: newUserID, password: newUserPassword, isAdmin: false };
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            alert('Usu치rio criado com sucesso!');
            document.getElementById('newUserID').value = '';
            document.getElementById('newUserPassword').value = '';
        }
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
